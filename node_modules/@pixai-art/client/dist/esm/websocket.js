import { createClient } from 'graphql-ws';
export const createRestartableClient = (options) => {
    let restartRequested = false;
    let restart = () => {
        restartRequested = true;
    };
    const client = createClient({
        ...options,
        on: {
            ...options.on,
            opened: _socket => {
                options.on?.opened?.(_socket);
                const socket = _socket;
                restart = () => {
                    if (socket.readyState === WebSocket.OPEN) {
                        socket.close(4205, 'Client Restart');
                    }
                    else {
                        restartRequested = true;
                    }
                };
                if (restartRequested) {
                    restartRequested = false;
                    restart();
                }
            },
        },
    });
    return {
        ...client,
        restart: () => restart(),
    };
};
//# sourceMappingURL=websocket.js.map