"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createRestartableClient = void 0;
const graphql_ws_1 = require("graphql-ws");
const createRestartableClient = (options) => {
    let restartRequested = false;
    let restart = () => {
        restartRequested = true;
    };
    const client = (0, graphql_ws_1.createClient)({
        ...options,
        on: {
            ...options.on,
            opened: _socket => {
                options.on?.opened?.(_socket);
                const socket = _socket;
                restart = () => {
                    if (socket.readyState === WebSocket.OPEN) {
                        socket.close(4205, 'Client Restart');
                    }
                    else {
                        restartRequested = true;
                    }
                };
                if (restartRequested) {
                    restartRequested = false;
                    restart();
                }
            },
        },
    });
    return {
        ...client,
        restart: () => restart(),
    };
};
exports.createRestartableClient = createRestartableClient;
//# sourceMappingURL=websocket.js.map